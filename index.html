<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Caution par Carte Bancaire</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 500px;
        margin: auto;
        background: #f2f2f2;
        border-radius: 10px;
      }
      #card-element {
        margin: 20px 0;
      }
      button {
        padding: 10px 20px;
        background-color: #6772e5;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>Dépôt de Caution</h2>
    <form id="payment-form">
      <label for="email">Email :</label>
      <input id="email" name="email" type="email" required /><br /><br />

      <div id="card-element"><!-- Stripe Card Element --></div>

      <button type="submit">Valider la caution</button>
      <div id="message"></div>
    </form>

    <script>
      const stripe = Stripe("pk_test_51RbkxQReX2iceXti56j2tMQcx71NFU4O9ofkSR6cVPOkZXez8cPhtTmdxUrbLnDvUT5r4nZeqgqr7Cet5Qhjv5Yr00pXimD9Oo")
                            que Stripe

      fetch("/api/create-setup-intent", {
        method: "POST",
      })
        .then((res) => res.json())
        .then((data) => {
          const elements = stripe.elements();
          const cardElement = elements.create("card");
          cardElement.mount("#card-element");

          const form = document.getElementById("payment-form");
          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const { setupIntent, error } = await stripe.confirmCardSetup(
              data.clientSecret,
              {
                payment_method: {
                  card: cardElement,
                  billing_details: { email },
                },
              }
            );
            const message = document.getElementById("message");
            if (error) {
              message.textContent = "❌ Erreur : " + error.message;
            } else {
              message.textContent = "✅ Caution validée avec succès !";
            }
          });
        });
    </script>
  </body>
</html>

